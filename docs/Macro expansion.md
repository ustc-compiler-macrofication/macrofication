# Macro expansion
åœ¨è¿™é‡Œæˆ‘ä»¬å°†ç®€è¦ä»‹ç»å®æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œè¿™æ˜¯ä¸ºäº†ä¸‹ä¸€æ­¥ä»‹ç»macroficationå¦‚ä½•å·¥ä½œåšé“ºå«ï¼›

åœ¨è¿™é‡Œæˆ‘ä»¬çš„å®çš„å®šä¹‰å¤§å¤šç‹¬ç«‹äºç›®æ ‡è¯­è¨€ï¼Œç°åœ¨æˆ‘ä»¬å‡è®¾ä»£ç å·²ç»è¢«å±•å¼€æˆä¸€ç³»åˆ—çš„tokensï¼Œè¿™äº›tokenså·²ç»è¢«è¿›ä¸€æ­¥å¤„ç†ä¸ºä¸€ç³»åˆ—çš„tokens treeã€‚

å¦‚ä¸‹ï¼Œæˆ‘ä»¬è®¾hä¸ºä¸€ä¸ªtokens treeï¼Œé‚£ä¹ˆä»–å¯ä»¥æ˜¯å•ä¸ªtokens kï¼Œä¹Ÿå¯ä»¥æ˜¯è¢«åŒ…å›´åœ¨åˆ†éš”ç¬¦{s}ä¸­çš„åºåˆ—:
```
h :: = k | {s}
s ::= k Â· s | {s} Â· s | ç©º
```
åœ¨è¿™é‡Œçš„ç¨‹åºè¢«è½¬æ¢æˆä¸€ä¸ªtokens treeçš„åºåˆ—ï¼›

ç”¨äºåˆ’åˆ†tokens treeçš„å­—ç¬¦ä¸ç¨‹åºè‡ªå·±çš„ç®—æ³•æ— å…³(è¿™æ˜¯æ˜¾è€Œæ˜“è§çš„)ï¼Œæ‰€ä»¥ä¸€ä¸ªå¤æ‚çš„é˜…è¯»å™¨/è¯æ³•åˆ†æå™¨å¯ä»¥æ”¯æŒè®¸å¤šä¸åŒçš„åˆ†éš”ç¬¦ï¼Œä¾‹å¦‚ï¼Œ {}ï¼Œ[]æˆ–ï¼ˆï¼‰ï¼›æ‰€ä»¥è¿™ç§æ–¹æ³•æ”¯æŒLisp-likeå’ŒJavaScript-likeä¸¤ç§è¯­è¨€ã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼š
JavaScriptè¯­å¥â€œarr [i + 1];â€å¯ä»¥è¡¨ç¤ºä¸ºä»¥ä¸‹çš„tokens treeåºåˆ—ï¼Œå…¶ä¸­æ–¹æ‹¬å·â€œ[â€å’Œâ€œ]â€åœ¨åˆ†éš”ç¬¦åŒ¹é…ä¹‹åå˜æˆç®€å•çš„tokens kã€‚
```

```

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†ä¸€ä¸ªæ¨¡å¼æˆ–æ¨¡æ¿å®šä¹‰ä¸ºä¸€ç³»åˆ—åŒ…å«åœ¨åˆ†éš”ç¬¦ä¸­çš„æ ‡è®°ï¼Œå˜é‡å’Œæ¨¡å¼æ¨¡æ¿åºåˆ—ã€‚

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†å°†å®ç¯å¢ƒÎ£ä¸­çš„æ‰€æœ‰å®è¡¨ç¤ºä¸ºï¼ˆåç§°ï¼Œæ¨¡å¼ï¼Œæ¨¡æ¿ï¼‰å…ƒç»„çš„æœ‰åºåºåˆ—ã€‚
` `

æ¨¡å¼å˜é‡xè¦ä¹ˆæœªç»‘å®šï¼Œè¦ä¹ˆç»‘å®šåˆ°tokens tree hã€‚æˆ‘ä»¬ä½¿ç”¨Î˜æ¥è¡¨ç¤ºå˜é‡ç»‘å®šçš„ç¯å¢ƒã€‚
` `

åœ¨æœ€ç®€å•çš„æƒ…å†µä¸‹ï¼Œæ‰€æœ‰å®åœ¨æ‰©å±•ä¹‹å‰æ˜¯å·²çŸ¥çš„ï¼Œå¹¶ä¸”å…·æœ‰å…¨å±€èŒƒå›´ã€‚ç»™å®šå®çš„å›ºå®šåˆ—è¡¨Î£ï¼Œé‚£ä¹ˆå°†å®å±•å¼€ä¹‹åï¼ŒåŸæœ‰çš„tokens treeï¼ˆä¸åŒ…æ‹¬å®å®šä¹‰ï¼‰å°†è½¬æ¢ä¸ºæ‰€æœ‰å®éƒ½å·²ç»è¢«åŒ¹é…å’Œæ‰©å±•çš„æ–°çš„tokens treeåºåˆ—ï¼š

å¯¹äºæ¯ä¸ªtokens kï¼Œæˆ‘ä»¬å°†æŸ¥æ‰¾å…¶å®ç¯å¢ƒÎ£ä¸ºä¸€ä¸ªåä¸ºkçš„å®å¹¶ä¸”ç”¨æ¨¡å¼påŒ¹é…æ ‡è®°ã€‚ å¦‚æœä¸å­˜åœ¨è¿™æ ·çš„å®ï¼Œæˆ‘ä»¬å°†ä¸ä½¿ç”¨å®è¯­æ³•æ¥ä»£æ›¿tokensï¼Œå¦åˆ™ä½¿ç”¨ç¬¬ä¸€ä¸ªæ‰¾åˆ°çš„ç›¸åº”çš„åŒ¹é…çš„å®æ¥åŒ¹é…è¯­æ³•ï¼Œäº§ç”Ÿæ–°çš„å˜é‡ç»‘å®šï¼Œç„¶åç”¨å®ƒæ¥è½¬å½•æ¨¡æ¿tã€‚åŒæ—¶å¾—åˆ°çš„tokensåºåˆ—ä¹Ÿå¯èƒ½åŒ…å«å…¶ä»–å®è°ƒç”¨ï¼Œæ‰€ä»¥æœ‰å¯èƒ½ä¼šæœ‰é€’å½’çš„è°ƒç”¨ï¼Œç›´åˆ°æ‰€æœ‰çš„å®éƒ½è¢«æ‰©å±•ã€‚è¿™ä¸ªè¿‡ç¨‹ä¸èƒ½ä¿è¯ç»ˆæ­¢ï¼Œå› ä¸ºrule macrosæ˜¯Turing-completeçš„ã€‚
ä¾‹å¦‚ï¼Œä¸‹é¢çš„å®å°†å¯¼è‡´æ— é™æ‰©å±•ï¼š
```
macro omega { rule {} = > { omega } }
```
















